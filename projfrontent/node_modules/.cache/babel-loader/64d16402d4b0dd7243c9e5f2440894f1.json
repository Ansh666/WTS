{"ast":null,"code":"import _objectSpread from\"E:/PROJECTS/Python/WTS/projfrontent/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"E:/PROJECTS/Python/WTS/projfrontent/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from\"react\";import{Redirect}from\"react-router-dom\";import{cartEmpty}from\"./helper/cartHelper\";import{getmeToken,processPayment}from\"./helper/paymentHelper\";import{createOrder}from\"./helper/orderHelper\";import{isAuthenticated,signout}from\"../auth/helper\";import DropIn from\"braintree-web-drop-in-react\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var PaymentB=function PaymentB(_ref){var products=_ref.products,_ref$reload=_ref.reload,reload=_ref$reload===void 0?undefined:_ref$reload,_ref$setReload=_ref.setReload,setReload=_ref$setReload===void 0?function(f){return f;}:_ref$setReload;var _useState=useState({loading:false,success:false,clientToken:null,error:\"\",instance:{}}),_useState2=_slicedToArray(_useState,2),info=_useState2[0],setInfo=_useState2[1];var userId=isAuthenticated&&isAuthenticated().user.id;var token=isAuthenticated&&isAuthenticated().token;var getToken=function getToken(userId,token){getmeToken(userId,token).then(function(info){if(info.error){setInfo(_objectSpread(_objectSpread({},info),{},{error:info.error}));signout(function(){return/*#__PURE__*/_jsx(Redirect,{to:\"/\"});});}else{var clientToken=info.clientToken;setInfo({clientToken:clientToken});}});};useEffect(function(){getToken(userId,token);},[userId,token]);var getAmount=function getAmount(){var amount=0;// eslint-disable-next-line\nproducts.map(function(p){amount=amount+parseInt(p.price);});return amount;};var onPurchase=function onPurchase(){setInfo({loading:true});var nonce;// eslint-disable-next-line\nvar getNonce=info.instance.requestPaymentMethod().then(function(data){console.log(\"MYDATA\",data);nonce=data.nonce;var paymentData={paymentMethodNonce:nonce,amount:getAmount()};processPayment(userId,token,paymentData).then(function(response){console.log(\"POINT-1\",response);if(response.error){if(response.code===\"1\"){console.log(\"PAYMENT Failed!\");signout(function(){return/*#__PURE__*/_jsx(Redirect,{to:\"/\"});});}}else{setInfo(_objectSpread(_objectSpread({},info),{},{success:response.success,loading:false}));console.log(\"PAYMENT SUCCESS\");var product_names=\"\";products.forEach(function(item){product_names+=item.name+\", \";});var orderData={products:product_names,transaction_id:response.transaction.id,amount:response.transaction.amount};createOrder(userId,token,orderData).then(function(response){if(response.error){if(response.code===\"1\"){console.log(\"Order Failed!\");signout(function(){return/*#__PURE__*/_jsx(Redirect,{to:\"/\"});});}}else{if(response.success===true){console.log(\"ORDER PLACED!!\");}}}).catch(function(error){setInfo({loading:false,success:false});console.log(\"Order FAILED\",error);});cartEmpty(function(){console.log(\"Did we got a crash?\");});setReload(!reload);}}).catch(function(error){setInfo({loading:false,success:false});console.log(\"PAYMENT FAILED\",error);});});};var showbtnDropIn=function showbtnDropIn(){return/*#__PURE__*/_jsx(\"div\",{children:info.clientToken!==null&&products.length>0?/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(DropIn,{options:{authorization:info.clientToken},onInstance:function onInstance(instance){return info.instance=instance;}}),/*#__PURE__*/_jsx(\"button\",{onClick:onPurchase,className:\"btn btn-block btn-success\",children:\"Buy Now\"})]}):/*#__PURE__*/_jsx(\"h3\",{children:\"Please login first or add something in cart\"})});};return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"h3\",{children:[\"Your bill is Rs. \",getAmount()]}),showbtnDropIn()]});};export default PaymentB;","map":{"version":3,"sources":["E:/PROJECTS/Python/WTS/projfrontent/src/core/PaymentB.js"],"names":["React","useState","useEffect","Redirect","cartEmpty","getmeToken","processPayment","createOrder","isAuthenticated","signout","DropIn","PaymentB","products","reload","undefined","setReload","f","loading","success","clientToken","error","instance","info","setInfo","userId","user","id","token","getToken","then","getAmount","amount","map","p","parseInt","price","onPurchase","nonce","getNonce","requestPaymentMethod","data","console","log","paymentData","paymentMethodNonce","response","code","product_names","forEach","item","name","orderData","transaction_id","transaction","catch","showbtnDropIn","length","authorization"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport { Redirect } from \"react-router-dom\";\r\nimport { cartEmpty } from \"./helper/cartHelper\";\r\nimport { getmeToken, processPayment } from \"./helper/paymentHelper\";\r\nimport { createOrder } from \"./helper/orderHelper\";\r\nimport { isAuthenticated, signout } from \"../auth/helper\";\r\n\r\nimport DropIn from \"braintree-web-drop-in-react\";\r\n\r\nconst PaymentB = ({ products, reload = undefined, setReload = (f) => f }) => {\r\n  const [info, setInfo] = useState({\r\n    loading: false,\r\n    success: false,\r\n    clientToken: null,\r\n    error: \"\",\r\n    instance: {},\r\n  });\r\n\r\n  const userId = isAuthenticated && isAuthenticated().user.id;\r\n  const token = isAuthenticated && isAuthenticated().token;\r\n\r\n  const getToken = (userId, token) => {\r\n    getmeToken(userId, token).then((info) => {\r\n      if (info.error) {\r\n        setInfo({\r\n          ...info,\r\n          error: info.error,\r\n        });\r\n        signout(() => {\r\n          return <Redirect to=\"/\" />;\r\n        });\r\n      } else {\r\n        const clientToken = info.clientToken;\r\n        setInfo({ clientToken });\r\n      }\r\n    });\r\n  };\r\n\r\n  useEffect(() => {\r\n    getToken(userId, token);\r\n  }, [userId, token]);\r\n\r\n  const getAmount = () => {\r\n    let amount = 0;\r\n    // eslint-disable-next-line\r\n    products.map((p) => {\r\n      amount = amount + parseInt(p.price);\r\n    });\r\n    return amount;\r\n  };\r\n  const onPurchase = () => {\r\n    setInfo({ loading: true });\r\n    let nonce;\r\n    // eslint-disable-next-line\r\n    let getNonce = info.instance.requestPaymentMethod().then((data) => {\r\n      console.log(\"MYDATA\", data);\r\n      nonce = data.nonce;\r\n      const paymentData = {\r\n        paymentMethodNonce: nonce,\r\n        amount: getAmount(),\r\n      };\r\n      processPayment(userId, token, paymentData)\r\n        .then((response) => {\r\n          console.log(\"POINT-1\", response);\r\n          if (response.error) {\r\n            if (response.code === \"1\") {\r\n              console.log(\"PAYMENT Failed!\");\r\n              signout(() => {\r\n                return <Redirect to=\"/\" />;\r\n              });\r\n            }\r\n          } else {\r\n            setInfo({ ...info, success: response.success, loading: false });\r\n            console.log(\"PAYMENT SUCCESS\");\r\n\r\n            let product_names = \"\";\r\n            products.forEach(function (item) {\r\n              product_names += item.name + \", \";\r\n            });\r\n\r\n            const orderData = {\r\n              products: product_names,\r\n              transaction_id: response.transaction.id,\r\n              amount: response.transaction.amount,\r\n            };\r\n            createOrder(userId, token, orderData)\r\n              .then((response) => {\r\n                if (response.error) {\r\n                  if (response.code === \"1\") {\r\n                    console.log(\"Order Failed!\");\r\n                    signout(() => {\r\n                      return <Redirect to=\"/\" />;\r\n                    });\r\n                  }\r\n                } else {\r\n                  if (response.success === true) {\r\n                    console.log(\"ORDER PLACED!!\");\r\n                  }\r\n                }\r\n              })\r\n              .catch((error) => {\r\n                setInfo({ loading: false, success: false });\r\n                console.log(\"Order FAILED\", error);\r\n              });\r\n            cartEmpty(() => {\r\n              console.log(\"Did we got a crash?\");\r\n            });\r\n\r\n            setReload(!reload);\r\n          }\r\n        })\r\n        .catch((error) => {\r\n          setInfo({ loading: false, success: false });\r\n          console.log(\"PAYMENT FAILED\", error);\r\n        });\r\n    });\r\n  };\r\n\r\n  const showbtnDropIn = () => {\r\n    return (\r\n      <div>\r\n        {info.clientToken !== null && products.length > 0 ? (\r\n          <div>\r\n            <DropIn\r\n              options={{ authorization: info.clientToken }}\r\n              onInstance={(instance) => (info.instance = instance)}\r\n            ></DropIn>\r\n            <button onClick={onPurchase} className=\"btn btn-block btn-success\">\r\n              Buy Now\r\n            </button>\r\n          </div>\r\n        ) : (\r\n          <h3>Please login first or add something in cart</h3>\r\n        )}\r\n      </div>\r\n    );\r\n  };\r\n\r\n  return (\r\n    <div>\r\n      <h3>Your bill is Rs. {getAmount()}</h3>\r\n      {showbtnDropIn()}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default PaymentB;\r\n"]},"metadata":{},"sourceType":"module"}