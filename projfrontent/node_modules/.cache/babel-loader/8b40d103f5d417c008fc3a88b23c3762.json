{"ast":null,"code":"var _jsxFileName = \"G:\\\\PROJECTS\\\\Python\\\\WTS\\\\projfrontent\\\\src\\\\core\\\\PaymentB.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect } from \"react\";\nimport { Redirect } from \"react-router-dom\";\nimport { cartEmpty } from \"./helper/cartHelper\";\nimport { getmeToken, processPayment } from \"./helper/paymentHelper\";\nimport { createOrder } from \"./helper/orderHelper\";\nimport { isAuthenticated, signout } from \"../auth/helper\";\nimport DropIn from \"braintree-web-drop-in-react\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst PaymentB = ({\n  products,\n  reload = undefined,\n  setReload = f => f\n}) => {\n  _s();\n\n  const [info, setInfo] = useState({\n    loading: false,\n    success: false,\n    clientToken: null,\n    error: \"\",\n    instance: {}\n  });\n  const userId = isAuthenticated && isAuthenticated().user.id;\n  const token = isAuthenticated && isAuthenticated().token;\n\n  const getToken = (userId, token) => {\n    getmeToken(userId, token).then(info => {\n      if (info.error) {\n        setInfo({ ...info,\n          error: info.error\n        });\n        signout(() => {\n          return /*#__PURE__*/_jsxDEV(Redirect, {\n            to: \"/\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 30,\n            columnNumber: 18\n          }, this);\n        });\n      } else {\n        const clientToken = info.clientToken;\n        setInfo({\n          clientToken\n        });\n      }\n    });\n  };\n\n  useEffect(() => {\n    getToken(userId, token);\n  }, [userId, token]);\n\n  const getAmount = () => {\n    let amount = 0;\n    products.map(p => {\n      amount = amount + parseInt(p.price);\n    });\n    return amount;\n  };\n\n  const onPurchase = () => {\n    setInfo({\n      loading: true\n    });\n    let nonce;\n    let getNonce = info.instance.requestPaymentMethod().then(data => {\n      console.log(\"MYDATA\", data);\n      nonce = data.nonce;\n      const paymentData = {\n        paymentMethodNonce: nonce,\n        amount: getAmount()\n      };\n      processPayment(userId, token, paymentData).then(response => {\n        console.log(\"POINT-1\", response);\n\n        if (response.error) {\n          if (response.code === \"1\") {\n            console.log(\"PAYMENT Failed!\");\n            signout(() => {\n              return /*#__PURE__*/_jsxDEV(Redirect, {\n                to: \"/\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 67,\n                columnNumber: 24\n              }, this);\n            });\n          }\n        } else {\n          setInfo({ ...info,\n            success: response.success,\n            loading: false\n          });\n          console.log(\"PAYMENT SUCCESS\");\n          let product_names = \"\";\n          products.forEach(function (item) {\n            product_names += item.name + \", \";\n          });\n          const orderData = {\n            products: product_names,\n            transaction_id: response.transaction.id,\n            amount: response.transaction.amount\n          };\n          createOrder(userId, token, orderData).then(response => {\n            if (response.error) {\n              if (response.code === \"1\") {\n                console.log(\"Order Failed!\");\n                signout(() => {\n                  return /*#__PURE__*/_jsxDEV(Redirect, {\n                    to: \"/\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 90,\n                    columnNumber: 30\n                  }, this);\n                });\n              }\n            } else {\n              if (response.success === true) {\n                console.log(\"ORDER PLACED!!\");\n              }\n            }\n          }).catch(error => {\n            setInfo({\n              loading: false,\n              success: false\n            });\n            console.log(\"Order FAILED\", error);\n          });\n          cartEmpty(() => {\n            console.log(\"Did we got a crash?\");\n          });\n          setReload(!reload);\n        }\n      }).catch(error => {\n        setInfo({\n          loading: false,\n          success: false\n        });\n        console.log(\"PAYMENT FAILED\", error);\n      });\n    });\n  };\n\n  const showbtnDropIn = () => {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: info.clientToken !== null && products.length > 0 ? /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(DropIn, {\n          options: {\n            authorization: info.clientToken\n          },\n          onInstance: instance => info.instance = instance\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 122,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: onPurchase,\n          className: \"btn btn-block btn-success\",\n          children: \"Buy Now\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 126,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 121,\n        columnNumber: 11\n      }, this) : /*#__PURE__*/_jsxDEV(\"h3\", {\n        children: \"Please login first or add something in cart\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 131,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 119,\n      columnNumber: 7\n    }, this);\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n      children: [\"Your bill is Rs. \", getAmount()]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 139,\n      columnNumber: 7\n    }, this), showbtnDropIn()]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 138,\n    columnNumber: 5\n  }, this);\n};\n\n_s(PaymentB, \"Tg6WwDxM3lWtlfW9TNq87u5Idhg=\");\n\n_c = PaymentB;\nexport default PaymentB;\n\nvar _c;\n\n$RefreshReg$(_c, \"PaymentB\");","map":{"version":3,"sources":["G:/PROJECTS/Python/WTS/projfrontent/src/core/PaymentB.js"],"names":["React","useState","useEffect","Redirect","cartEmpty","getmeToken","processPayment","createOrder","isAuthenticated","signout","DropIn","PaymentB","products","reload","undefined","setReload","f","info","setInfo","loading","success","clientToken","error","instance","userId","user","id","token","getToken","then","getAmount","amount","map","p","parseInt","price","onPurchase","nonce","getNonce","requestPaymentMethod","data","console","log","paymentData","paymentMethodNonce","response","code","product_names","forEach","item","name","orderData","transaction_id","transaction","catch","showbtnDropIn","length","authorization"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport { Redirect } from \"react-router-dom\";\r\nimport { cartEmpty } from \"./helper/cartHelper\";\r\nimport { getmeToken, processPayment } from \"./helper/paymentHelper\";\r\nimport { createOrder } from \"./helper/orderHelper\";\r\nimport { isAuthenticated, signout } from \"../auth/helper\";\r\n\r\nimport DropIn from \"braintree-web-drop-in-react\";\r\n\r\nconst PaymentB = ({ products, reload = undefined, setReload = (f) => f }) => {\r\n  const [info, setInfo] = useState({\r\n    loading: false,\r\n    success: false,\r\n    clientToken: null,\r\n    error: \"\",\r\n    instance: {},\r\n  });\r\n\r\n  const userId = isAuthenticated && isAuthenticated().user.id;\r\n  const token = isAuthenticated && isAuthenticated().token;\r\n\r\n  const getToken = (userId, token) => {\r\n    getmeToken(userId, token).then((info) => {\r\n      if (info.error) {\r\n        setInfo({\r\n          ...info,\r\n          error: info.error,\r\n        });\r\n        signout(() => {\r\n          return <Redirect to=\"/\" />;\r\n        });\r\n      } else {\r\n        const clientToken = info.clientToken;\r\n        setInfo({ clientToken });\r\n      }\r\n    });\r\n  };\r\n\r\n  useEffect(() => {\r\n    getToken(userId, token);\r\n  }, [userId, token]);\r\n\r\n  const getAmount = () => {\r\n    let amount = 0;\r\n    products.map((p) => {\r\n      amount = amount + parseInt(p.price);\r\n    });\r\n    return amount;\r\n  };\r\n  const onPurchase = () => {\r\n    setInfo({ loading: true });\r\n    let nonce;\r\n    let getNonce = info.instance.requestPaymentMethod().then((data) => {\r\n      console.log(\"MYDATA\", data);\r\n      nonce = data.nonce;\r\n      const paymentData = {\r\n        paymentMethodNonce: nonce,\r\n        amount: getAmount(),\r\n      };\r\n      processPayment(userId, token, paymentData)\r\n        .then((response) => {\r\n          console.log(\"POINT-1\", response);\r\n          if (response.error) {\r\n            if (response.code === \"1\") {\r\n              console.log(\"PAYMENT Failed!\");\r\n              signout(() => {\r\n                return <Redirect to=\"/\" />;\r\n              });\r\n            }\r\n          } else {\r\n            setInfo({ ...info, success: response.success, loading: false });\r\n            console.log(\"PAYMENT SUCCESS\");\r\n\r\n            let product_names = \"\";\r\n            products.forEach(function (item) {\r\n              product_names += item.name + \", \";\r\n            });\r\n\r\n            const orderData = {\r\n              products: product_names,\r\n              transaction_id: response.transaction.id,\r\n              amount: response.transaction.amount,\r\n            };\r\n            createOrder(userId, token, orderData)\r\n              .then((response) => {\r\n                if (response.error) {\r\n                  if (response.code === \"1\") {\r\n                    console.log(\"Order Failed!\");\r\n                    signout(() => {\r\n                      return <Redirect to=\"/\" />;\r\n                    });\r\n                  }\r\n                } else {\r\n                  if (response.success === true) {\r\n                    console.log(\"ORDER PLACED!!\");\r\n                  }\r\n                }\r\n              })\r\n              .catch((error) => {\r\n                setInfo({ loading: false, success: false });\r\n                console.log(\"Order FAILED\", error);\r\n              });\r\n            cartEmpty(() => {\r\n              console.log(\"Did we got a crash?\");\r\n            });\r\n\r\n            setReload(!reload);\r\n          }\r\n        })\r\n        .catch((error) => {\r\n          setInfo({ loading: false, success: false });\r\n          console.log(\"PAYMENT FAILED\", error);\r\n        });\r\n    });\r\n  };\r\n\r\n  const showbtnDropIn = () => {\r\n    return (\r\n      <div>\r\n        {info.clientToken !== null && products.length > 0 ? (\r\n          <div>\r\n            <DropIn\r\n              options={{ authorization: info.clientToken }}\r\n              onInstance={(instance) => (info.instance = instance)}\r\n            ></DropIn>\r\n            <button onClick={onPurchase} className=\"btn btn-block btn-success\">\r\n              Buy Now\r\n            </button>\r\n          </div>\r\n        ) : (\r\n          <h3>Please login first or add something in cart</h3>\r\n        )}\r\n      </div>\r\n    );\r\n  };\r\n\r\n  return (\r\n    <div>\r\n      <h3>Your bill is Rs. {getAmount()}</h3>\r\n      {showbtnDropIn()}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default PaymentB;\r\n"]},"metadata":{},"sourceType":"module"}